@version: 3.28

# syslog-ng configuration - Compatible with Grafana Alloy
# Alloy reads logs directly from /var/log/ files
# This configuration listens on network ports for log forwarding

source s_network {
    network(
        transport("udp")
        port({{ syslog_ng_udp_port }})
    );
    network(
        transport("tcp")
        port({{ syslog_ng_tcp_port }})
    );
};

# Option 1: Log to local file (Alloy can read from here)
destination d_file {
    file("/var/log/syslog-ng-forwarded.log");
};

# Option 2: Forward to Promtail (if still in use)
# Uncomment if Promtail is still deployed
# destination d_promtail {
#     network(
#         "{{ ansible_host }}"
#         port({{ promtail_syslog_port }})
#         transport("tcp")
#     );
# };

log {
    source(s_network);
    destination(d_file);
    # destination(d_promtail);  # Uncomment if using Promtail
};
