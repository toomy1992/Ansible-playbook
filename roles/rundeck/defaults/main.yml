---
# Rundeck role defaults
# Configuration aligned with: https://docs.rundeck.com/docs/administration/configuration/

#=============================================================================
# SERVER CONFIGURATION
# https://docs.rundeck.com/docs/administration/configuration/config-file-reference.html
#=============================================================================

# Grails server URL - the URL that users will use to access Rundeck
rundeck_grails_url: "http://localhost:4440"

# Server binding configuration
rundeck_port: 4440
rundeck_address: "127.0.0.1"
rundeck_context_path: "/"

# Framework server identification
rundeck_server_name: "{{ ansible_hostname }}"
rundeck_server_uuid: ""  # Leave empty for auto-generation

#=============================================================================
# DATABASE CONFIGURATION
# https://docs.rundeck.com/docs/administration/configuration/database/
#=============================================================================

# Database backend: 'h2' (embedded) or 'postgresql' (recommended for production)
rundeck_database_backend: "postgresql"

# PostgreSQL connection settings (used when rundeck_database_backend is 'postgresql')
rundeck_db_host: "localhost"
rundeck_db_port: 5432
rundeck_db_name: "rundeck"
rundeck_db_user: "rundeckuser"
rundeck_db_password: "{{ vault_rundeck_db_password | default('rundeckpassword') }}"

# JDBC driver class
rundeck_db_driver: "org.postgresql.Driver"

# Connection URL - auto-generated if not specified
rundeck_db_url: "jdbc:postgresql://{{ rundeck_db_host }}:{{ rundeck_db_port }}/{{ rundeck_db_name }}"

# Connection pool settings
rundeck_db_pool_max_active: 50
rundeck_db_pool_max_idle: 10
rundeck_db_pool_min_idle: 5
rundeck_db_pool_initial_size: 5

# H2 embedded database settings (used when rundeck_database_backend is 'h2')
rundeck_h2_data_dir: "/var/lib/rundeck/data"

#=============================================================================
# EXECUTION CONFIGURATION
# https://docs.rundeck.com/docs/administration/configuration/config-file-reference.html#execution-mode
#=============================================================================

# Execution mode: 'active' or 'passive'
# - active: jobs and ad-hoc commands can be run
# - passive: jobs and ad-hoc commands cannot be run (read-only mode)
rundeck_execution_mode: "active"

# Maximum number of concurrent executions (0 = unlimited)
rundeck_execution_max_concurrent: 0

# Retry delay for failed executions (seconds)
rundeck_execution_retry_delay: 0

# Output limit per step (bytes, 0 = unlimited)
rundeck_execution_output_limit: 0

# Enable/disable kill job feature
rundeck_execution_kill_enabled: true

#=============================================================================
# LOGGING CONFIGURATION
# https://docs.rundeck.com/docs/administration/configuration/config-file-reference.html#logging
#=============================================================================

# Log level: TRACE, DEBUG, INFO, WARN, ERROR
rundeck_loglevel: "INFO"

# Log directory
rundeck_log_dir: "/var/log/rundeck"

# Enable/disable audit logging
rundeck_audit_logging: true

# Execution logs configuration
rundeck_execution_logs_dir: "/var/lib/rundeck/logs"
rundeck_execution_logs_fileStorage_plugin: ""

# Log file storage (for cluster mode - optional)
# rundeck_log_storage_plugin: ""

#=============================================================================
# SESSION CONFIGURATION
#=============================================================================

# Session timeout in minutes (0 = no timeout)
rundeck_session_timeout: 30

# Remember me duration (seconds)
rundeck_session_remember_me_duration: 2592000  # 30 days

#=============================================================================
# SECURITY CONFIGURATION
# https://docs.rundeck.com/docs/administration/security/
#=============================================================================

# User authentication
rundeck_users: []
# Example:
# rundeck_users:
#   - username: admin
#     password: "{{ vault_rundeck_admin_password }}"
#     roles: "admin,user"
#   - username: operator
#     password: "{{ vault_rundeck_operator_password }}"
#     roles: "user"

# Enable/disable file-based authentication (realm.properties)
rundeck_auth_file_enabled: true

# LDAP/AD authentication (optional)
rundeck_ldap_enabled: false
rundeck_ldap_url: ""
rundeck_ldap_bind_dn: ""
rundeck_ldap_bind_password: ""
rundeck_ldap_user_base_dn: ""
rundeck_ldap_user_search_filter: "(uid={0})"
rundeck_ldap_role_base_dn: ""
rundeck_ldap_role_member_attribute: "member"

# API token security
rundeck_api_tokens_duration_max: 0  # 0 = unlimited
rundeck_api_require_tokens: false

# Enable/disable first user login admin setting
rundeck_security_first_login_admin: true

#=============================================================================
# SSH CONFIGURATION
#=============================================================================

# SSH key generation
rundeck_ssh_key_generate: false
rundeck_ssh_key_type: "rsa"
rundeck_ssh_key_bits: 4096
rundeck_ssh_key_path: "/var/lib/rundeck/.ssh/id_rsa"

# Default SSH timeout (seconds)
rundeck_ssh_timeout: 0  # 0 = no timeout

# SSH connection retries
rundeck_ssh_retries: 1

# Default authentication type: 'password' or 'privateKey'
rundeck_ssh_authentication: "privateKey"

#=============================================================================
# GUI CONFIGURATION
#=============================================================================

# Enable/disable GUI features
rundeck_gui_brand_html: ""
rundeck_gui_title: "Rundeck"
rundeck_gui_logo: ""
rundeck_gui_logo_width: "200px"
rundeck_gui_login_welcome: ""

# Pagination defaults
rundeck_gui_execution_tail_lines: 20
rundeck_gui_static_user_resources_enabled: false

# Job execution follow mode
rundeck_gui_job_exec_show_tail: true

#=============================================================================
# PLUGIN CONFIGURATION
#=============================================================================

# Enable plugins directory scanning
rundeck_plugins_enabled: true
rundeck_plugins_dir: "/var/lib/rundeck/libext"

# Pre-installed plugins (list of URLs to download)
rundeck_plugins_install: []
# Example:
# rundeck_plugins_install:
#   - url: "https://github.com/rundeck-plugins/example/releases/download/v1.0/plugin.jar"
#     name: "example-plugin.jar"

#=============================================================================
# NOTIFICATIONS CONFIGURATION
#=============================================================================

# Email notification settings
rundeck_mail_enabled: false
rundeck_mail_host: "localhost"
rundeck_mail_port: 25
rundeck_mail_from: "rundeck@localhost"
rundeck_mail_default_recipients: ""

# Webhook notifications
rundeck_webhook_enabled: false

#=============================================================================
# METRICS CONFIGURATION
# https://docs.rundeck.com/docs/administration/configuration/config-file-reference.html#metrics
#=============================================================================

# Enable metrics collection
rundeck_metrics_enabled: true
rundeck_metrics_jmx_enabled: false
rundeck_metrics_request_filter_enabled: true

# Prometheus metrics endpoint (if using Prometheus)
rundeck_metrics_prometheus_enabled: false
rundeck_metrics_prometheus_endpoint: "/metrics"

#=============================================================================
# STORAGE CONFIGURATION
#=============================================================================

# Key storage configuration
rundeck_storage_provider: "file"  # file, db, vault
rundeck_storage_path: "/var/lib/rundeck/var/storage"

# Enable key storage converter (encryption)
rundeck_storage_converter_enabled: false
rundeck_storage_converter_plugin: ""  # jasypt-encryption, etc.

#=============================================================================
# PROJECT CONFIGURATION
#=============================================================================

# Projects base directory
rundeck_projects_dir: "/var/rundeck/projects"

# Default project settings
rundeck_project_default_ssh_keypath: "{{ rundeck_ssh_key_path }}"
rundeck_project_defaults:
  project.ssh-authentication: "{{ rundeck_ssh_authentication }}"
  project.ssh-keypath: "{{ rundeck_ssh_key_path }}"
  resources.source.1.type: "file"
  resources.source.1.config.format: "resourceyaml"
  resources.source.1.config.generateFileAutomatically: "true"

#=============================================================================
# CLUSTER CONFIGURATION (Enterprise features - optional)
#=============================================================================

# Cluster mode (requires Rundeck Enterprise)
rundeck_cluster_enabled: false

#=============================================================================
# JAVA/JVM CONFIGURATION
#=============================================================================

# Java home path
rundeck_java_home: "/usr/lib/jvm/java-11-openjdk-amd64"

# JVM memory settings
rundeck_jvm_max_heap: "2048m"
rundeck_jvm_min_heap: "256m"

# Additional JVM options
rundeck_jvm_options: ""
# Example: "-Dfile.encoding=UTF-8 -Djava.security.egd=file:/dev/./urandom"

#=============================================================================
# BACKUP CONFIGURATION
#=============================================================================

# Enable automated backups
rundeck_backup_enabled: false
rundeck_backup_dir: "/var/backups/rundeck"
rundeck_backup_retention_days: 7

#=============================================================================
# DIRECTORIES AND PATHS
#=============================================================================

# Configuration directories
rundeck_config_dir: "/etc/rundeck"
rundeck_base_dir: "/var/lib/rundeck"
rundeck_data_dir: "/var/lib/rundeck/data"

# Temporary directory for job execution
rundeck_tmp_dir: "/tmp/rundeck"
