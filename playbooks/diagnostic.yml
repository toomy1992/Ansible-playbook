---
# Diagnostic playbook - Check system status after configuration

- name: System diagnostics
  hosts: all
  gather_facts: yes

  tasks:
    - name: Check hostname
      shell: hostname -f
      register: hostname_result
      changed_when: false

    - name: Check timezone
      shell: timedatectl status
      register: timezone_result
      changed_when: false
      
    - name: Check SSH status
      service_facts:
      register: service_facts

    - name: Check firewall status
      shell: ufw status
      register: firewall_result
      changed_when: false
      become: yes
      failed_when: false

    - name: Display system diagnostics
      debug:
        msg: |
          Hostname: {{ hostname_result.stdout }}
          Timezone: {{ timezone_result.stdout | default('Not checked') }}
          SSH Service: {{ service_facts.ansible_facts.services['ssh.service'].state | default('Unknown') }}
          Firewall: {{ firewall_result.stdout_lines[0] | default('Not checked') }}
